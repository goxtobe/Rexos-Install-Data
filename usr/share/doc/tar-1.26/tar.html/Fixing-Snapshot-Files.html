<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- 
This manual is for GNU tar (version
1.26, 12 March 2011), which creates and extracts files
from archives.

Copyright (C) 1992, 1994, 1995, 1996, 1997, 1999, 2000, 2001,
2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.3 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with the Front-Cover Texts being "A GNU Manual",
and with the Back-Cover Texts as in (a) below.  A copy of the license
is included in the section entitled "GNU Free Documentation
License".

(a) The FSF's Back-Cover Text is: "You have the freedom to
copy and modify this GNU manual.  Buying copies from the FSF
supports it in developing GNU and promoting software freedom." -->
<!-- Created by GNU Texinfo 5.1, http://www.gnu.org/software/texinfo/ -->
<head>
<title>GNU tar 1.26: Fixing Snapshot Files</title>

<meta name="description" content="GNU tar 1.26: Fixing Snapshot Files">
<meta name="keywords" content="GNU tar 1.26: Fixing Snapshot Files">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#Top" rel="start" title="Top">
<link href="Index-of-Command-Line-Options.html#Index-of-Command-Line-Options" rel="index" title="Index of Command Line Options">
<link href="Index.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index.html#Top" rel="up" title="Top">
<link href="Tar-Internals.html#Tar-Internals" rel="next" title="Tar Internals">
<link href="Configuring-Help-Summary.html#Configuring-Help-Summary" rel="previous" title="Configuring Help Summary">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.indentedblock {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smallindentedblock {margin-left: 3.2em; font-size: smaller}
div.smalllisp {margin-left: 3.2em}
kbd {font-style:oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:nowrap}
span.nolinebreak {white-space:nowrap}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">
<a name="Fixing-Snapshot-Files"></a>
<div class="header">
<p>
Next: <a href="Tar-Internals.html#Tar-Internals" accesskey="n" rel="next">Tar Internals</a>, Previous: <a href="Configuring-Help-Summary.html#Configuring-Help-Summary" accesskey="p" rel="previous">Configuring Help Summary</a>, Up: <a href="index.html#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="Index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index-of-Command-Line-Options.html#Index-of-Command-Line-Options" title="Index" rel="index">Index</a>]</p>
</div>
<hr>
<a name="Fixing-Snapshot-Files-1"></a>
<h2 class="appendix">Appendix C Fixing Snapshot Files</h2>

<a name="index-Device-numbers_002c-changing"></a>
<a name="index-snapshot-files_002c-editing"></a>
<a name="index-snapshot-files_002c-fixing-device-numbers"></a>
<p>Sometimes device numbers can change after upgrading your kernel
version or reconfiguring the hardware.  Reportedly this is the case with
some newer <i>Linux</i> kernels, when using <acronym>LVM</acronym>.  In majority of
cases this change is unnoticed by the users.  However, it influences
<code>tar</code> incremental backups: the device number is stored in tar
snapshot files (see <a href="Snapshot-Files.html#Snapshot-Files">Snapshot Files</a>) and is used to determine whether
the file has changed since the last backup.  If the device numbers
change for some reason, the next backup you run will be a full backup.
</p>
<a name="index-tar_002dsnapshot_002dedit"></a>
<p>To minimize the impact in these cases, GNU <code>tar</code> comes with
the <code>tar-snapshot-edit</code> utility for inspecting and updating
device numbers in snapshot files.  The utility, written by
Dustin J. Mitchell, is available from
<a href="http://www.gnu.org/software/tar/utils/tar-snapshot-edit.html"><acronym>GNU</acronym> <code>tar</code> home page</a>.
</p>
<p>To obtain the device numbers used in the snapshot file, run
</p>
<div class="smallexample">
<pre class="smallexample">$ <kbd>tar-snapshot-edit <var>snapfile</var></kbd>
</pre></div>

<p>where <var>snapfile</var> is the name of the snapshot file (you can supply as many
files as you wish in a single command line).
</p>
<p>To update all occurrences of the given device number in the file, use
<samp>-r</samp> option.  It takes a single argument of the form
&lsquo;<samp><var>olddev</var>-<var>newdev</var></samp>&rsquo;,  where <var>olddev</var> is the device number
used in the snapshot file, and <var>newdev</var> is the corresponding new device
number.  Both numbers may be specified in hex (e.g., &lsquo;<samp>0xfe01</samp>&rsquo;),
decimal (e.g., &lsquo;<samp>65025</samp>&rsquo;), or as a major:minor number pair (e.g.,
&lsquo;<samp>254:1</samp>&rsquo;).  To change several device numbers at once, specify them
in a single comma-separated list, as in
<samp>-r 0x3060-0x4500,0x307-0x4600</samp>.
</p>
<p>Before updating the snapshot file, it is a good idea to create a backup
copy of it.  This is accomplished by &lsquo;<samp>-b</samp>&rsquo; option.  The name of the
backup file is obtained by appending &lsquo;<samp>~</samp>&rsquo; to the original file name.
</p>
<p>An example session:
</p><div class="smallexample">
<pre class="smallexample">$ <kbd>tar-snapshot-edit /var/backup/snap.a</kbd>
file version 2
/tmp/snap: Device 0x0306 occurs 634 times.
$ <kbd>tar-snapshot-edit -b -r 0x0306-0x4500 /var/backup/snap.a</kbd>
file version 2
</pre></div>

<hr>
<div class="header">
<p>
Next: <a href="Tar-Internals.html#Tar-Internals" accesskey="n" rel="next">Tar Internals</a>, Previous: <a href="Configuring-Help-Summary.html#Configuring-Help-Summary" accesskey="p" rel="previous">Configuring Help Summary</a>, Up: <a href="index.html#Top" accesskey="u" rel="up">Top</a> &nbsp; [<a href="Index.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="Index-of-Command-Line-Options.html#Index-of-Command-Line-Options" title="Index" rel="index">Index</a>]</p>
</div>



</body>
</html>
